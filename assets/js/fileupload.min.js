jQuery(document).ready(function(e){function h(j){e(".peek-a-bar").hide().remove();var i=new e.peekABar({padding:"1em",animation:{type:"fade",duration:1000},cssClass:"ssp-notification-bar",backgroundColor:"#4aa3df"});i.show({html:j})}function d(j){var i=j.type;var k=i.split("/");var l=false;if("audio"==k[0]||"video"==k[0]){l=true}return l}function c(i){var j=i.replace(/[,\/#!$%\^&\*;:{}=\-_`'~()+"|? ]/g," ");return j.replace(/\s{1,}/g,"-")}if(typeof upload_credentials!="undefined"){var g=upload_credentials.bucket;var b=upload_credentials.show_slug;var a=upload_credentials.episodes_url;var f=new plupload.Uploader({runtimes:"html5",browse_button:"ssp_select_file",multi_selection:false,container:"ssp_upload_container",url:"https://"+g+".s3.amazonaws.com:443/",multipart_params:{}});f.init();f.bind("Init",function(){e("#ssp_upload_notification").remove()});f.bind("FilesAdded",function(i,k){var j=k[0];if(d(j)){h('Uploading file to Castos Hosting. You can continue editing this post while the file uploads. <b id="ssp_upload_progress"></b>');f.start()}else{h("You have selected an invalid file type, please select a valid audio or video file.")}});f.bind("BeforeUpload",function(j,k){var l=c(k.name);var i={key:upload_credentials.show_slug+"/"+l,Filename:upload_credentials.show_slug+"/"+l,acl:"public-read","Content-Type":"",AWSAccessKeyId:upload_credentials.access_key_id,policy:upload_credentials.policy,signature:upload_credentials.signature};f.settings.multipart_params=i});f.bind("Error",function(i,j){alert("Error #"+j.code+": "+j.message)});f.bind("UploadProgress",function(i,j){e("#ssp_upload_progress").html(j.percent+"%")});f.bind("UploadComplete",function(j,o){h("Processing Castos Hosting file.");var n=o[0];var p=c(n.name);var l=n.size;var i=plupload.formatSize(n.size);var k="https://s3.amazonaws.com/"+g+"/"+b+"/"+p;var m=a+b+"/"+p;e.ajax({method:"GET",url:ajaxurl,data:{action:"ssp_store_podmotor_file",podmotor_file_path:k}}).done(function(q){if(q.status=="success"){h("Uploading file to Castos Hosting Complete.");e("#podmotor_file_id").val(q.file_id);e("#filesize_raw").val(l);e("#filesize").val(i);e("#duration").val(q.file_duration);e("#upload_audio_file").val(m);e(".peek-a-bar").fadeOut(5000)}else{h(q.message)}})})}});